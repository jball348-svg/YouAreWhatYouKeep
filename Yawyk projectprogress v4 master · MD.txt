# You Are What You Keep â€” Complete Project Document
### Version 4 â€” Master Handoff Document

> This document is a complete record of everything built, every decision made, all known issues, and the full technical roadmap. It is written to allow any developer or LLM to pick up this project with full context. Read it top to bottom before touching anything.

---

## Table of Contents

1. Game Manifesto
2. Project Setup & Tools
3. Folder Structure
4. Scene Architecture
5. Systems Architecture Overview
6. Scripts â€” Complete Reference
7. UI Canvas â€” Structure & State
8. Memory Assets Created
9. Input System
10. Build Phases â€” Complete Roadmap
11. Pre-wired Dependencies & Future Hooks
12. Known Issues Log

---

# PART 1 â€” GAME MANIFESTO

### Working Title
**You Are What You Keep**

### Core Philosophy
The goal is not to win â€” the goal is to live a meaningful life inside a system. This game rejects traditional progression loops (XP, loot, grinding) in favour of emotional payoff, player-authored meaning, and systemic emergence. The game should create memories, not milestones.

### Player Objective
There is no explicit win state. The player is trying to live an interesting life, accumulate meaningful moments, and shape who they become through what they experience. Endings are reflective, not victorious.

---

### Design Pillars

**Moments over Progression** â€” The primary reward is a felt experience: awe, regret, nostalgia, calm, pride. If a mechanic exists, it must serve a moment.

**Identity as Inventory** â€” The player collects memories, traits, and ways of being. Your build is what you've lived, what you've kept, what you've let go of.

**Time as Gentle Pressure** â€” Time is always present but not punishing. Bittersweet, inevitable, motivating. Time creates meaning by making things finite.

**Systems That Respect the Player** â€” Avoid over-explaining. Trust player interpretation. Allow ambiguity. Meaning emerges through interaction, not instruction.

**Self-Authored Reward** â€” The best moments are not scripted. The game enables useless but beautiful actions, personal rituals, quiet discovery.

---

### Core Mechanics

**Memories as Inventory** â€” Players collect memories instead of items. Each memory occupies a limited slot, subtly alters gameplay or perception, and shapes identity. You cannot keep everything. Forgetting is a mechanic.

Example memories: "Swam at midnight", "Played guitar in the rain", "Got lost in the woods"

**Limited Inner Space** â€” 5â€“8 memory slots. Creates emotional tradeoffs, personal curation, identity evolution. Letting go should feel significant.

**Moments That Transform** â€” Certain experiences permanently change the player. A near-death fall becomes fearlessness or fragility. Performing publicly becomes a confidence aura. Deep solitude becomes heightened awareness. Transformation replaces levelling.

**The World Remembers** â€” Meaningful actions leave subtle echoes. A place where you linger becomes warmer. A dangerous jump becomes a local legend. Music played somewhere lingers faintly later.

**Skills as Lived Experience** â€” Skills emerge from behaviour and fade when abandoned. Climb often â†’ natural agility. Sit quietly â†’ heightened awareness. Help others â†’ social warmth.

---

### Tone and Aesthetic
Warm, reflective, slightly melancholic, hopeful. Not bleak. Not cynical. Stylised realism or soft minimalism. Strong lighting language. Expressive colour shifts. Calm environmental storytelling.

Reference points: Journey, Flower (thatgamecompany), Firewatch, Gris.

### One-Line Summary
*A game about becoming someone through the moments you choose to keep.*

---

# PART 2 â€” PROJECT SETUP & TOOLS

| Item | Value |
|------|-------|
| Engine | Unity (Latest LTS) |
| Render Pipeline | URP (Universal Render Pipeline) |
| Input System | New Unity Input System (package installed) |
| Version Control | Git + GitHub, managed via GitHub Desktop |
| Text Rendering | TextMeshPro (package installed, essentials imported) |

### Unity Project Settings
- Asset Serialization Mode: **Force Text**
- Version Control Mode: **Visible Meta Files**

### Post Processing
A Global Volume exists in `_Persistent` scene with a profile containing: Color Adjustments, Bloom, Vignette, Depth of Field. Driven at runtime by `EmotionalResponseSystem`.

**Critical:** Every individual value checkbox in the profile must be **ticked blue** (not grey) for runtime script control to work. Unticked values cannot be changed by scripts.

**Critical:** `PlayerCamera` must have **Post Processing enabled** in the Camera component (or Universal Additional Camera Data component) for effects to render.

### Commit History
1. Initial project setup
2. Phase 2: Player controller with weighted movement and camera bob
3. Phase 3: Memory system â€” data layer, moment triggers, first memories
4. Phase 4 complete: memory UI fully working â€” slots, prompts, reflection screen, replace mode, HUD dots
5. Phase 5 complete: emotional response system â€” post processing world state, layered audio, moment bloom response

---

# PART 3 â€” FOLDER STRUCTURE

```
Assets/
â”œâ”€â”€ _Game/
â”‚   â”œâ”€â”€ Art/
â”‚   â”‚   â”œâ”€â”€ Characters/
â”‚   â”‚   â”œâ”€â”€ Environment/
â”‚   â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â””â”€â”€ VFX/
â”‚   â”œâ”€â”€ Audio/
â”‚   â”‚   â”œâ”€â”€ Ambient/          â† AMB_ audio files live here
â”‚   â”‚   â”œâ”€â”€ Music/
â”‚   â”‚   â””â”€â”€ SFX/
â”‚   â”œâ”€â”€ Materials/
â”‚   â”‚   â”œâ”€â”€ Characters/
â”‚   â”‚   â”œâ”€â”€ Environment/
â”‚   â”‚   â””â”€â”€ PostProcessing/
â”‚   â”œâ”€â”€ Prefabs/
â”‚   â”‚   â”œâ”€â”€ Characters/       â† PFB_Player
â”‚   â”‚   â”œâ”€â”€ Environment/
â”‚   â”‚   â”œâ”€â”€ Memories/         â† MEM_MomentTrigger_Base
â”‚   â”‚   â”œâ”€â”€ Systems/          â† SYS_ prefabs (--- SYSTEMS --- prefab)
â”‚   â”‚   â””â”€â”€ UI/               â† UI_Canvas, UI_MemoryCard, UI_SlotDot
â”‚   â”œâ”€â”€ Scenes/
â”‚   â”‚   â”œâ”€â”€ Core/             â† _Boot, _Persistent
â”‚   â”‚   â””â”€â”€ Locations/        â† Location_Opening
â”‚   â”œâ”€â”€ Scripts/
â”‚   â”‚   â”œâ”€â”€ Core/             â† GameManager, AudioManager, EmotionalResponseSystem
â”‚   â”‚   â”œâ”€â”€ Identity/         â† Phase 6
â”‚   â”‚   â”œâ”€â”€ Memories/         â† MemoryData, MemoryInstance, MemorySystem
â”‚   â”‚   â”œâ”€â”€ Player/           â† PlayerController, CameraController
â”‚   â”‚   â”œâ”€â”€ Time/             â† Phase 7
â”‚   â”‚   â”œâ”€â”€ World/            â† MomentTrigger
â”‚   â”‚   â””â”€â”€ UI/               â† All UI scripts
â”‚   â””â”€â”€ ScriptableObjects/
â”‚       â”œâ”€â”€ Memories/         â† MEM_ assets
â”‚       â”œâ”€â”€ Traits/           â† Phase 6
â”‚       â””â”€â”€ Moments/
â””â”€â”€ ThirdParty/
```

### Prefab Naming Convention
- `SYS_` â€” system objects
- `ENV_` â€” environment pieces
- `MEM_` â€” memory-related objects
- `UI_` â€” interface elements
- `CHR_` â€” characters
- `PFB_` â€” player prefab

---

# PART 4 â€” SCENE ARCHITECTURE

### Build Settings Order
1. `_Boot`
2. `_Persistent`
3. `Location_Opening`

### _Persistent Scene Hierarchy
```
_Persistent
â””â”€â”€ --- SYSTEMS ---                  â† DontDestroyOnLoad set HERE (root only)
    â”œâ”€â”€ GameManager                  â† GameManager.cs
    â”œâ”€â”€ MemorySystem                 â† MemorySystem.cs
    â”œâ”€â”€ AudioManager                 â† AudioManager.cs
    â””â”€â”€ EmotionalResponseSystem      â† EmotionalResponseSystem.cs
â””â”€â”€ --- ENVIRONMENT ---
    â””â”€â”€ GlobalPostProcessVolume      â† Global Volume with URP post processing profile
```

**Critical rule:** Only the root `--- SYSTEMS ---` calls `DontDestroyOnLoad`. Children inherit persistence. Never call `DontDestroyOnLoad` on child objects.

**The `--- SYSTEMS ---` object is saved as a Prefab** in `Assets/_Game/Prefabs/Systems/`. To update it after adding new child systems: select `--- SYSTEMS ---` in the Hierarchy â†’ Overrides â†’ Apply All to Prefab.

### Location_Opening Scene Hierarchy
```
Location_Opening
â”œâ”€â”€ Player                           â† PFB_Player prefab (has Audio Listener on PlayerCamera)
â”œâ”€â”€ [Environment geometry]           â† floor on Ground layer
â”œâ”€â”€ Moment_[Name]                    â† MomentTrigger objects (several placed for testing)
â””â”€â”€ UICanvas                         â† UI_Canvas prefab
```

---

# PART 5 â€” SYSTEMS ARCHITECTURE OVERVIEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA LAYER                           â”‚
â”‚  MemoryData (ScriptableObject)                         â”‚
â”‚  TraitType (enum)                                      â”‚
â”‚  MemoryCategory (enum)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RUNTIME STATE                          â”‚
â”‚  MemoryInstance (plain C# class)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PERSISTENT MANAGERS                          â”‚
â”‚                                                         â”‚
â”‚  GameManager              â† state machine               â”‚
â”‚  MemorySystem             â† slots, events               â”‚
â”‚  AudioManager             â† layered ambient audio       â”‚
â”‚  EmotionalResponseSystem  â† post processing world state â”‚
â”‚                                                         â”‚
â”‚  [Phase 6] IdentitySystem                              â”‚
â”‚  [Phase 7] TimeSystem                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORLD      â”‚ â”‚  UI LAYER                               â”‚
â”‚  OBJECTS    â”‚ â”‚  UIManager                              â”‚
â”‚             â”‚ â”‚  MomentPromptUI                         â”‚
â”‚  Moment     â”‚ â”‚  MemorySlotHUD                          â”‚
â”‚  Trigger    â”‚ â”‚  MemoryReflectUI                        â”‚
â”‚             â”‚ â”‚  MemoryCardUI                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PLAYER                                â”‚
â”‚  PlayerController    â† movement, physics                â”‚
â”‚  CameraController    â† bob, tilt                        â”‚
â”‚  [Phase 6] traits alter movement/perception             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Communication Pattern
Systems communicate through **C# events**, not direct references. `MemorySystem` fires events. Other systems subscribe. No system needs to know another exists. This keeps code decoupled and maintainable.

---

# PART 6 â€” SCRIPTS COMPLETE REFERENCE

---

## GameManager.cs
**Path:** `Assets/_Game/Scripts/Core/GameManager.cs`
**Attached to:** `GameManager` (child of `--- SYSTEMS ---`) in `_Persistent`
**Pattern:** Singleton â€” `GameManager.Instance`

**Game States:**
```
Booting, Playing, Reflecting, Transitioning, Ending
```

**Note:** `CurrentState` temporarily hardcoded to `GameState.Playing` for testing. Replace with proper boot sequence in Phase 8.

**Public API:**
```csharp
GameManager.Instance.SetGameState(GameState.Playing);
GameManager.Instance.IsPlaying();                         // bool
GameManager.Instance.CurrentState;                        // GameState
GameManager.Instance.OnGameStateChanged += MyMethod;
```

---

## PlayerController.cs
**Path:** `Assets/_Game/Scripts/Player/PlayerController.cs`
**Attached to:** Root `Player` object
**Prefab:** `Assets/_Game/Prefabs/Characters/PFB_Player`
**Requires:** Rigidbody (Mass 70, Drag 5, Angular Drag 999, Freeze Rotation XYZ), CapsuleCollider (Height 1.8, Radius 0.4, Center Y 0.9)
**Tag:** Player object must be tagged `Player`

**Inspector tuning values:**
| Field | Default | Feel |
|-------|---------|------|
| Walk Speed | 3.5 | Lower = contemplative |
| Acceleration | 8 | Lower = dreamy |
| Deceleration | 12 | Stop speed |
| Jump Force | 4 | |
| Gravity Multiplier | 2.5 | Weight |
| Look Sensitivity | 0.15 | Lower = cinematic |
| Vertical Look Clamp | 80 | Degrees |
| Ground Check Distance | 0.15 | |

**Note:** These are base values. Phase 6 IdentitySystem will apply trait modifiers as offsets from these values.

**Dependencies:** GameManager (IsPlaying), PlayerInputActions, Ground layer on floor geometry

---

## CameraController.cs
**Path:** `Assets/_Game/Scripts/Player/CameraController.cs`
**Attached to:** `PlayerCamera` (child of CameraRoot, child of Player)
**Tagged:** MainCamera
**Has:** Camera component, Audio Listener component

**Player Hierarchy:**
```
Player â† PlayerController, Rigidbody, CapsuleCollider, Tag:Player
â”œâ”€â”€ CameraRoot (Y: 1.7)
â”‚   â””â”€â”€ PlayerCamera â† Camera, CameraController, Audio Listener, Tag:MainCamera
â””â”€â”€ BodyRoot
```

---

## MemoryData.cs
**Path:** `Assets/_Game/Scripts/Memories/MemoryData.cs`
**Type:** ScriptableObject
**Create via:** Right-click â†’ Memory â†’ New Memory
**Assets in:** `Assets/_Game/ScriptableObjects/Memories/`

**Fields:**
```csharp
// Core
string memoryTitle
string memoryDescription
MemoryCategory category
float emotionalWeight       // 0-1

// World Echo â€” Phase 7
Color worldTintContribution // colour this memory adds to the world
AudioClip ambientLayer      // personal audio layer for this specific memory

// Identity Traits â€” Phase 6
TraitType[] reinforcedTraits
TraitType[] erodedTraits

// Presentation
Sprite memoryIcon
Color memoryColour          // UI card accent + MomentTrigger glow colour
```

**Enums:**
```csharp
MemoryCategory: Nature, Solitude, Connection, Risk, Creation, Loss, Wonder, Stillness
TraitType: Fearless, Fragile, Curious, Calm, Aware, Warm, Agile, Melancholic, Resilient, Open
```

---

## MemoryInstance.cs
**Path:** `Assets/_Game/Scripts/Memories/MemoryInstance.cs`
**Type:** Plain C# class (not MonoBehaviour)

**Fields:**
```csharp
MemoryData data
float timeAcquired
bool hasBeenReflectedOn     // set true when player clicks card in UI
float vividness             // 0-1, Phase 7 will fade this over time
```

**Properties:** `.Title` `.Description` `.Category` `.EmotionalWeight` `.MemoryColour` `.Icon`

---

## MemorySystem.cs
**Path:** `Assets/_Game/Scripts/Memories/MemorySystem.cs`
**Attached to:** `MemorySystem` (child of `--- SYSTEMS ---`) in `_Persistent`
**Pattern:** Singleton â€” `MemorySystem.Instance`
**Note:** Does NOT call DontDestroyOnLoad (inherits from root)

**Config:** `maxMemorySlots = 6` (Inspector, range 3â€“10)

**Events:**
```csharp
OnMemoryKept(MemoryInstance)
OnMemoryForgotten(MemoryInstance)
OnMemorySlotsFull(MemoryData, List<MemoryInstance>)
OnMemoriesChanged()
```

**Public API:**
```csharp
OfferMemory(memoryData)
KeepMemory(memoryData)
ForgetMemory(memoryInstance)
ReplaceMemory(toForget, toKeepData)
GetAllMemories()                      // List<MemoryInstance>
HasFreeSlot()                         // bool
HasMemoryOfCategory(category)         // bool
GetTotalEmotionalWeight()             // float
GetUsedSlots()                        // int
GetSlotCount()                        // int
AlreadyHolding(memoryData)            // bool
GetGameTime()                         // float (replaced by TimeSystem in Phase 7)
```

---

## MomentTrigger.cs
**Path:** `Assets/_Game/Scripts/World/MomentTrigger.cs`
**Attached to:** World objects that offer memories
**Base Prefab:** `Assets/_Game/Prefabs/Memories/MEM_MomentTrigger_Base`
**Requires:** SphereCollider (auto-added), Player tagged `Player`

**Inspector fields:**
```csharp
MemoryData memoryData
float triggerRadius = 3f
string promptText
float lingerTime = 0f       // 0 = press E, >0 = auto after N seconds
bool consumeOnUse = true
bool visibleInWorld = true  // enables glow light
float glowRadius = 2.5f
float glowIntensity = 0.5f
float pulseSpeed = 1.2f
float pulseAmount = 0.15f
```

**Behaviour:**
- Creates a Point Light child object at runtime using `memoryData.memoryColour`
- Light pulses gently (sine wave breathing)
- Brightens when player enters trigger zone
- Fades out over 1.2 seconds when memory is consumed
- Gizmo draws coloured sphere in Scene view

---

## AudioManager.cs
**Path:** `Assets/_Game/Scripts/Core/AudioManager.cs`
**Attached to:** `AudioManager` (child of `--- SYSTEMS ---`) in `_Persistent`
**Pattern:** Singleton â€” `AudioManager.Instance`
**Note:** Does NOT call DontDestroyOnLoad

**Architecture:** One AudioSource per layer, all on this GameObject. Layers have target volumes. Update() smoothly fades toward them.

**Inspector fields:**
```csharp
AudioClip baseAmbientClip         // always-on quiet background
float baseAmbientVolume = 0.15f
AudioLayerConfig[] categoryLayers // one entry per MemoryCategory
float fadeDuration = 3f
float maxLayerVolume = 0.4f
AudioClip momentStingClip         // short sound when memory is taken
float momentStingVolume = 0.6f
```

**AudioLayerConfig (Serializable class):**
```csharp
MemoryCategory category
AudioClip clip
```

**Behaviour:**
- On `OnMemoryKept`: fades in the layer matching that memory's category, plays moment sting
- On `OnMemoryForgotten`: fades out that category layer if no memories of that category remain
- Moment sting uses `momentStingSource.time = 0.3f` offset to skip dead air (tune as needed)

**Public API:**
```csharp
AudioManager.Instance.TriggerMomentSting()
AudioManager.Instance.BoostLayer(category, boostAmount, duration)
```

**Audio files location:** `Assets/_Game/Audio/Ambient/`
**Note:** `ambientLayer` field on individual MemoryData assets is NOT used by AudioManager â€” that is a Phase 7 hook for per-memory personal audio layers. AudioManager operates at category level only.

---

## EmotionalResponseSystem.cs
**Path:** `Assets/_Game/Scripts/Core/EmotionalResponseSystem.cs`
**Attached to:** `EmotionalResponseSystem` (child of `--- SYSTEMS ---`) in `_Persistent`
**Pattern:** Singleton â€” `EmotionalResponseSystem.Instance`
**Note:** Does NOT call DontDestroyOnLoad

**Dependencies:**
- `GlobalPostProcessVolume` must be assigned in Inspector
- URP post processing packages installed
- `PlayerCamera` must have Post Processing **enabled** in Camera/Universal Additional Camera Data component
- Every value checkbox in the post processing profile must be **ticked blue**

**How it works:**
1. On `OnMemoryKept` â†’ calls `RecalculateWorldState()` + `TriggerMomentResponse()`
2. `RecalculateWorldState()` â†’ calculates target PP values from all held memories
3. `Update()` â†’ smoothly lerps actual PP values toward targets
4. `TriggerMomentResponse()` â†’ coroutine: bloom spike + time dilation, then releases

**Inspector values (tune for feel):**
```csharp
// Base state (no memories)
float baseSaturation = -30f
float baseContrast = 5f
float baseBloomIntensity = 0.2f
float baseVignetteIntensity = 0.2f
Color baseColourFilter = white

// Peak state (slots full)
float peakSaturation = 60f
float peakContrast = 15f
float peakBloomIntensity = 2.5f
float peakVignetteIntensity = 0.5f

// Moment response
float momentBloomSpike = 4f
float momentBloomDuration = 1.8f
float momentTimeDilation = 0.75f
float momentTimeDilationDuration = 0.8f

float transitionSpeed = 3f
```

**Colour tint system:** Blends all held memory `worldTintContribution` colours together weighted by `emotionalWeight Ã— vividness`. Result applied to post processing Color Filter. Set obvious distinct colours on MEM_ assets during development, dial to subtle for final feel.

**Public API (for Phase 6 & 7):**
```csharp
EmotionalResponseSystem.Instance.PushEmotionalState(satBoost, bloomBoost, duration)
```

---

## UIManager.cs
**Path:** `Assets/_Game/Scripts/UI/UIManager.cs`
**Attached to:** `UICanvas` root in each location scene
**Pattern:** Singleton â€” `UIManager.Instance`

**Manages:** cursor lock state, Tab toggle, memory system event responses
**Public API:**
```csharp
UIManager.Instance.ShowMomentPrompt(string text)
UIManager.Instance.HideMomentPrompt()
UIManager.Instance.CloseReflectScreen()
```

---

## MomentPromptUI.cs
**Path:** `Assets/_Game/Scripts/UI/MomentPromptUI.cs`
**Attached to:** `MomentPrompt` under HUD
**Behaviour:** Fades in/out via CanvasGroup alpha. Clears text after fade to prevent ghost text.

---

## MemorySlotHUD.cs
**Path:** `Assets/_Game/Scripts/UI/MemorySlotHUD.cs`
**Attached to:** `MemorySlotHUD` under HUD
**Behaviour:** Spawns dot per slot. Subscribes to memory events inside `InitialBuild()` called via `Invoke(0.15f)` delay to avoid singleton race condition. Dots animate between filled/empty colour on memory change.

---

## MemoryReflectUI.cs
**Path:** `Assets/_Game/Scripts/UI/MemoryReflectUI.cs`
**Attached to:** `MemoryReflect` under Screens

**Two modes:**
- **Normal** (Tab): browse, select, optionally forget. Forget closes screen.
- **Replace** (auto when slots full): must choose a memory to forget. Close button hidden.

---

## MemoryCardUI.cs
**Path:** `Assets/_Game/Scripts/UI/MemoryCardUI.cs`
**Attached to:** `UI_MemoryCard` prefab root
**Public:** `BoundMemory`, `Initialise()`, `SetSelected()`

---

# PART 7 â€” UI CANVAS STRUCTURE

## Hierarchy
```
UICanvas                             â† UIManager.cs, Canvas Scaler 1920x1080
â”œâ”€â”€ HUD
â”‚   â”œâ”€â”€ MemorySlotHUD                â† MemorySlotHUD.cs, bottom-right corner
â”‚   â”‚   â””â”€â”€ SlotContainer            â† Horizontal Layout Group, spawns dots
â”‚   â””â”€â”€ MomentPrompt                 â† MomentPromptUI.cs, CanvasGroup, bottom-centre
â”‚       â””â”€â”€ PromptText               â† TMP
â””â”€â”€ Screens
    â””â”€â”€ MemoryReflect                â† MemoryReflectUI.cs, CanvasGroup alpha 0
        â”œâ”€â”€ Backdrop                 â† full screen black overlay, Raycast ON
        â””â”€â”€ Panel                    â† 860x520 centred, Raycast OFF
            â”œâ”€â”€ Header               â† height 56, top full width
            â”‚   â””â”€â”€ CloseButton      â† TMP "Ã—", top-right
            â”œâ”€â”€ ReplaceModeNotice    â† amber bar, hidden by default
            â”‚   â””â”€â”€ ReplaceText      â† TMP
            â”œâ”€â”€ MemoryCardContainer  â† Scroll View, left 52%
            â”‚   â””â”€â”€ Viewport         â† Rect Mask 2D (NOT Mask+Image)
            â”‚       â””â”€â”€ Content      â† Vertical Layout Group + Content Size Fitter
            â”œâ”€â”€ DetailPanel          â† right 48%, Vertical Layout Group, hidden by default
            â”‚   â”œâ”€â”€ DetailCategory
            â”‚   â”œâ”€â”€ DetailTitle
            â”‚   â”œâ”€â”€ DetailDescription
            â”‚   â””â”€â”€ ForgetButton
            â””â”€â”€ SlotCountText        â† bottom-left of panel, below scroll area
```

## Critical UI Notes

**Viewport masking:** Use **Rect Mask 2D** component on Viewport â€” NOT the Mask+Image approach. Rect Mask 2D clips to RectTransform bounds without needing an Image component, which was causing the cream overlay issue.

**Raycast Target rules:**
- Backdrop: ON (blocks world clicks)
- Panel: OFF
- Header: OFF
- Cards: ON (must receive clicks)

**Hierarchy render order:** Objects lower in the hierarchy render on top. Backdrop must be above Panel in the list so Panel renders on top of Backdrop.

**MemoryCardContainer bottom offset:** Set to 36 to leave room for SlotCountText.

## UI_MemoryCard Prefab
```
MemoryCard              â† MemoryCardUI, Button (Transition:None), Outline, Image
â”‚   Layout Element: Min Height 72, Preferred Height 80, Flexible Width 1
â”‚   NO Vertical Layout Group on this root
â”œâ”€â”€ AccentBar           â† Image, left edge, width 4, coloured at runtime
â”œâ”€â”€ TitleText           â† TMP, upper half, Font 14, no wrap
â””â”€â”€ CategoryText        â† TMP, lower half, Font 10, bold, no wrap
```

---

# PART 8 â€” MEMORY ASSETS

All in `Assets/_Game/ScriptableObjects/Memories/`

| Asset | Title | Category | Weight | World Tint |
|-------|-------|----------|--------|------------|
| MEM_SatByWater | Sat by the water alone | Stillness | 0.6 | Soft cool blue |
| MEM_StoodOnHighGround | Stood somewhere high and looked out | Wonder | 0.7 | Pale gold |
| MEM_WalkedIntoRain | Walked into the rain without shelter | Risk | 0.5 | Deep slate |
| MEM_WatchedSunMove | Watched the light change | Stillness | 0.4 | Warm amber |
| MEM_FoundHiddenPlace | Found somewhere nobody else knew | Solitude | 0.8 | Forest green |

**Note:** `worldTintContribution` on each asset drives the colour filter blend in EmotionalResponseSystem. Use obviously distinct colours during development, dial to subtle for final release. `ambientLayer` field left empty â€” Phase 7 hook.

---

# PART 9 â€” INPUT SYSTEM

**Asset:** `Assets/_Game/Scripts/Core/PlayerInputActions`

| Action | Type | Binding | Used By |
|--------|------|---------|---------|
| Move | Value/Vector2 | WASD + Arrows | PlayerController, CameraController |
| Look | Value/Vector2 | Mouse Delta | PlayerController |
| Jump | Button | Space | PlayerController |
| Interact | Button | E | MomentTrigger |
| Reflect | Button | Tab | UIManager |

---

# PART 10 â€” BUILD PHASES ROADMAP

| Phase | Focus | Status |
|-------|-------|--------|
| 1 | Project setup, folder structure, GameManager, Git | âœ… Complete |
| 2 | First-person player controller, weighted movement, camera bob | âœ… Complete |
| 3 | Memory system â€” MemoryData, MemoryInstance, MemorySystem, MomentTrigger | âœ… Complete |
| 4 | Memory UI â€” slot HUD, prompts, reflection screen, replace mode | âœ… Complete |
| 5 | Emotional Response System â€” post processing world state, layered audio | âœ… Complete |
| 6 | Identity & Trait System â€” memories change the player | â³ Next |
| 7 | Time System + World Echo â€” world shifts to reflect lived experience | ğŸ”² Pending |
| 8 | Ending & Reflection Sequence â€” memory collage, epilogue | ğŸ”² Pending |

---

# PART 11 â€” PRE-WIRED DEPENDENCIES & FUTURE HOOKS

This section documents every hook already built into the codebase waiting for future phases. Do not remove these fields â€” they are intentional placeholders.

---

## Hook 1 â€” worldTintContribution â†’ EmotionalResponseSystem (ACTIVE Phase 5)

**Where:** `MemoryData.worldTintContribution`
**Status:** LIVE â€” currently drives the post processing Color Filter blend
**How:** EmotionalResponseSystem iterates all held memories, blends their tint colours weighted by emotionalWeight Ã— vividness, applies result to post processing Color Adjustments Color Filter

---

## Hook 2 â€” ambientLayer on MemoryData (Phase 7)

**Where:** `MemoryData.ambientLayer`
**Status:** Field exists, not wired
**Future use:** Phase 7 World Echo System will play this clip as a personal audio layer tied to this specific memory. Different from AudioManager's category layers â€” this is per-memory, highly personal audio.

---

## Hook 3 â€” reinforcedTraits / erodedTraits (Phase 6)

**Where:** `MemoryData.reinforcedTraits[]` and `MemoryData.erodedTraits[]`
**Status:** Fields exist, not wired
**Future use:** Phase 6 IdentitySystem subscribes to OnMemoryKept/OnMemoryForgotten. When a memory is kept, its reinforcedTraits shift upward and erodedTraits shift downward in the player's trait profile.

---

## Hook 4 â€” TraitType enum (Phase 6)

**Where:** Defined in `MemoryData.cs`
**Values:** Fearless, Fragile, Curious, Calm, Aware, Warm, Agile, Melancholic, Resilient, Open
**Future use:** IdentitySystem maintains a `Dictionary<TraitType, float>` (0â€“1 scale). PlayerController and CameraController will read trait values to modify movement, jump, sensitivity, camera behaviour.

**Planned trait effects on player:**
| Trait | Effect |
|-------|--------|
| Fearless | Increased jump height, reduced fall hesitation |
| Fragile | Reduced jump, camera shake near edges |
| Curious | MomentTrigger detection radius increases |
| Calm | Look sensitivity decreases (more contemplative) |
| Aware | Ambient audio becomes richer |
| Warm | World colour grading shifts warmer |
| Agile | Walk speed increases slightly |
| Melancholic | Time of day shifts toward dusk |
| Resilient | Memory vividness fades more slowly |
| Open | New moment triggers become visible |

**PlayerController will be modified in Phase 6** to read trait values as modifiers on top of base Inspector values. This is why movement values are Inspector-tunable now.

---

## Hook 5 â€” MemoryInstance.vividness (Phase 6 & 7)

**Where:** `MemoryInstance.vividness`
**Status:** Starts at 1f, never modified yet
**Future use:**
- Phase 6: IdentitySystem weights trait influence by vividness
- Phase 7: TimeSystem ticks vividness down over game time
- UI: card opacity will reflect vividness (faded memories appear visually faded)
- EmotionalResponseSystem already multiplies emotionalWeight Ã— vividness in colour blending

---

## Hook 6 â€” MemoryInstance.hasBeenReflectedOn (Phase 8)

**Where:** `MemoryInstance.hasBeenReflectedOn`
**Status:** Set to true when player clicks a card in MemoryReflectUI
**Future use:** Phase 8 ending sequence uses this to distinguish deliberately engaged memories from passively held ones. Reflected-on memories feature more prominently in the ending collage.

---

## Hook 7 â€” GetTotalEmotionalWeight() (Phase 8)

**Where:** `MemorySystem.GetTotalEmotionalWeight()`
**Future use:** Phase 8 uses this to determine ending emotional tone. High weight = heavy meaningful reflection. Low weight = lighter, more ambiguous ending.

---

## Hook 8 â€” HasMemoryOfCategory() (Phase 5, 6, 7)

**Where:** `MemorySystem.HasMemoryOfCategory(category)`
**Current use:** AudioManager uses this to decide whether to fade out a category layer when a memory is forgotten
**Future use:**
- Phase 7: World locations show traces of player's presence based on categories
- Phase 8: Ending narration describes the life lived using category composition

---

## Hook 9 â€” PushEmotionalState() (Phase 6 & 7)

**Where:** `EmotionalResponseSystem.PushEmotionalState(satBoost, bloomBoost, duration)`
**Status:** Built, not yet called from outside
**Future use:** Phase 6 IdentitySystem calls this when a trait threshold is crossed (e.g. becoming Fearless triggers a brief emotional world surge). Phase 7 calls it during significant time events.

---

## Hook 10 â€” AudioManager.BoostLayer() (Phase 6 & 7)

**Where:** `AudioManager.BoostLayer(category, boostAmount, duration)`
**Status:** Built, not yet called from outside
**Future use:** Phase 6 and 7 temporarily boost audio layers during significant identity or world moments.

---

## Hook 11 â€” GameState.Ending (Phase 8)

**Where:** `GameManager.GameState.Ending`
**Status:** Enum value exists, never set yet
**Future use:** Phase 8 EndingSystem sets this state to freeze player movement, disable UI, and trigger the reflection sequence.

---

## Phase 6 â€” Identity & Trait System (Detailed Plan)

**New script:** `IdentitySystem.cs` (persistent, child of `--- SYSTEMS ---`)

**Architecture:**
```csharp
// Maintains trait values 0-1
Dictionary<TraitType, float> traitValues

// Subscribes to:
MemorySystem.OnMemoryKept     â†’ reinforces/erodes traits from memory
MemorySystem.OnMemoryForgotten â†’ partially reverses trait changes

// Exposes:
float GetTraitValue(TraitType trait)
bool HasTrait(TraitType trait, float threshold = 0.5f)
event OnTraitChanged(TraitType, float newValue)
```

**PlayerController changes in Phase 6:**
- Reads `IdentitySystem.Instance.GetTraitValue()` to offset base movement values
- Example: `effectiveWalkSpeed = walkSpeed + (agileValue * 1.5f)`
- Traits apply as gentle modifiers, not binary switches

**CameraController changes in Phase 6:**
- Reads Calm trait for look sensitivity modifier
- Reads Fragile trait for edge-proximity camera shake

**New ScriptableObjects in Phase 6:**
- Trait threshold events â€” define what happens when a trait crosses 0.3, 0.6, 0.9

---

## Phase 7 â€” Time System & World Echo (Detailed Plan)

**New scripts:**
- `TimeSystem.cs` â€” replaces `MemorySystem.gameTime` float. Tracks game day/time/season. Fires `OnDayChanged`, `OnSeasonChanged`. Ticks `MemoryInstance.vividness` down.
- `WorldEchoSystem.cs` â€” per-location system. Places where player has lingered become warmer. Uses `MomentTrigger.OnMomentExperienced` to register location echoes.

**Time philosophy:** Passes gently. Full game cycle ~60-90 minutes real time. Felt through world changes, not countdowns. Never punishing.

---

## Phase 8 â€” Ending & Reflection Sequence (Detailed Plan)

**New script:** `EndingSystem.cs`

**Reads:**
- All held `MemoryInstance` objects + their vividness and hasBeenReflectedOn
- Player trait profile from IdentitySystem
- `GetTotalEmotionalWeight()` for emotional tone
- Category composition for narrative description

**Output:** Personalised memory collage sequence. Text-based narration. No score. No grade. Just: *here is who you became.* Every player sees a different ending.

---

# PART 12 â€” KNOWN ISSUES LOG

| Issue | Severity | Status | Notes |
|-------|----------|--------|-------|
| Memory cards not visible in reflect screen | High | âœ… Resolved | Fixed by replacing Mask+Image on Viewport with Rect Mask 2D component |
| Close button not clickable | High | âœ… Resolved | Fixed by setting Panel Image Raycast Target to OFF |
| Panel proportions inconsistent | Medium | âœ… Resolved | Fixed by setting Panel anchor to centre point (0.5,0.5) both min and max |
| Post processing not affecting scene | High | âœ… Resolved | PlayerCamera needed Post Processing enabled in Camera component |
| PP values calculating but not visually changing | Medium | âœ… Resolved | Individual value checkboxes in PP profile must be ticked blue |
| Tab key not opening reflect screen | Medium | âœ… Resolved | Input action binding lost â€” rebind Tab to Reflect if recurs |
| HUD dots flash on startup then disappear | Low | âœ… Resolved | Fixed with Invoke delay in MemorySlotHUD.Start() |
| Moment prompt text persists after memory taken | Low | âœ… Resolved | HideMomentPrompt() called in ExperienceMoment() |
| Forgetting memory left reflect screen open | Low | âœ… Resolved | OnForgetPressed now calls CloseReflectScreen() |
| DontDestroyOnLoad error on child systems | Low | âœ… Resolved | Only root object calls DontDestroyOnLoad |
| Audio Listener warning | Low | âœ… Resolved | Audio Listener added to PlayerCamera |
| Moment sting plays from wrong point in clip | Low | âœ… Resolved | momentStingSource.time offset set in TriggerMomentSting() |
| MemorySlotHUD not updating on memory change | Medium | âœ… Resolved | Subscriptions moved into InitialBuild() after Invoke delay |

---

*Document version 4 â€” Master. Replaces all previous versions.*
*Phases 1â€“5 complete. Phase 6 Identity & Trait System is next.*